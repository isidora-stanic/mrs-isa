dist: xenial
sudo: false
install: true

matrix:
  include:
    - language: java
      jdk: oraclejdk11
      services:
        - postgresql

      before_install:
        - cd backend
        - chmod +x mvnw

      addons:
        sonarcloud:
          organization: isidora-stanic
          token: 
            secure: "NFPjx6stTA/hMTmgYA6emk1pIKgEBpYmI8+r+QF1QvbKq0jblpw8X5BNsX6gkiHTIPBBj4DFpHE7OGtkggSRQGf6RjHIksbrIcmH1cbD1v9QFzkZTCxROQPB9f/q5qxU6ube05Rj5odHIjkbbT64veV4eBa8US0jksUNxOnrrgebqI4ChXJ9vGa30VK8LafLCY8d9PTp0/FRHY1CXWibTAep0OWoUUqH5Br11VqpGo+jGVLU9AlsLomVCm4HEEiZzFCOK0mlF/gFetUDfQAEoAlCw6s2NdsW5suWHWOtKYY96SPYzD/n0djwQoG1AH1rfz5/BE3g9RK1mPEV70vvFo+0n4s7UVrEsS4Cm7diSBt2Nq+bFwW258TksvvbWAXyaZSarggUYEVfsceeOh3Exo+AkcLvyeRL7iiD1lmMFZNUMQMuhcqehwbJinJJkirkcuJTQXI5wa5Kf6jRppLz3uKSY6oow1ueDPFX2diRum0CFfW93GEylMuw1+UAs0HYeKmeHcgQ15KiAgTI2ZBIs4YUaXj0/Wfq49tknnT+qto2TJBoyOvihV1/BY+PxOJWES9BiISlvNIOeaBu8wtJN8Pu4QCnmWbXn0T+RIT9yRc1y4vLAt1F8Rn6TEP5gN/hcVagUJ/+a/5PI2Mcb49d2Wy2HMWj2b+44r5bewdiG+c="

      script:
        - ./mvnw clean install -DskipTests=false -B
        - ./mvnw clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=isidora-stanic
        # - ./mvnw sonar:sonar -Dsonar.projectKey=$PROJECT_KEY -Dsonar.organization=mrs-isa -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=$SONAR_TOKEN

      dist: trusty

      deploy:
        provider: heroku
        api_key: $HEROKU_API_KEY
        on:
          branch: main
        app: pharmacy-tim9

    - language: node_js
      node_js:
      - "node"
      cache: npm
      script: 
        - cd frontend/pharmacy
      deploy:
        provider: heroku
        api_key: $HEROKU_API_KEY
        on:
          branch: main
        app: pharmacy9